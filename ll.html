<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Three.js FBX Loader Sample</title>
  <style>
    body { margin: 0; background: #000; }
    canvas { display: block; }
  </style>
  <!-- three.js 本体 -->
  <script src="https://unpkg.com/three@0.152.2/build/three.min.js"></script>
  <!-- OrbitControls -->
  <script src="https://unpkg.com/three@0.152.2/examples/js/controls/OrbitControls.js"></script>
  <!-- FBXLoader と依存の inflator -->
  <script src="https://unpkg.com/three@0.152.2/examples/js/libs/inflate.min.js"></script>
  <script src="https://unpkg.com/three@0.152.2/examples/js/loaders/FBXLoader.js"></script>
</head>
<body>
<script>
  let camera, scene, renderer, controls, mixer;
  const clock = new THREE.Clock();

  init();
  animate();

  function init() {
    // シーン
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x222222);

    // カメラ
    camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 1, 2000);
    camera.position.set(200, 300, 500);

    // ライト
    const dirLight = new THREE.DirectionalLight(0xffffff);
    dirLight.position.set(1, 1, 1).normalize();
    scene.add(dirLight);

    const ambient = new THREE.AmbientLight(0x404040);
    scene.add(ambient);

    // レンダラー
    renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // コントロール
    controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.1;

    // FBXモデル読み込み
    const loader = new THREE.FBXLoader();
    loader.load(
      'AE86.fbx', // モデルパス
      function (object) {
        object.scale.set(0.1, 0.1, 0.1);
        scene.add(object);

        if (object.animations && object.animations.length > 0) {
          mixer = new THREE.AnimationMixer(object);
          const action = mixer.clipAction(object.animations[0]);
          action.play();
        }
      },
      function (xhr) {
        console.log(`読み込み進行: ${(xhr.loaded / xhr.total * 100).toFixed(2)}%`);
      },
      function (error) {
        console.error('読み込みエラー:', error);
      }
    );

    window.addEventListener('resize', onWindowResize);
  }

  function onWindowResize() {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  }

  function animate() {
    requestAnimationFrame(animate);
    const delta = clock.getDelta();
    if (mixer) mixer.update(delta);
    controls.update();
    renderer.render(scene, camera);
  }
</script>
</body>
</html>

